"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,a){return t&&_defineProperties(e.prototype,t),a&&_defineProperties(e,a),e}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}!function(){var e,t,a=function(e){function AutoMove(){return _classCallCheck(this,AutoMove),_possibleConstructorReturn(this,_getPrototypeOf(AutoMove).call(this))}return _inherits(AutoMove,Laya.Script),_createClass(AutoMove,[{key:"onAwake",value:function(){this.setLinearVelocity(-4,0),Laya.stage.on("GameOver",this,function(){this.setLinearVelocity(0,0)}),Laya.stage.on("GameAgain",this,function(){this.setLinearVelocity(-4,0)})}},{key:"onUpdate",value:function(){Laya.stage.isGameOver&&this.setLinearVelocity(0,0)}},{key:"setLinearVelocity",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.owner.getComponent(Laya.RigidBody).linearVelocity={x:e,y:t}}}]),AutoMove}(),n=function(t){function RepeatingBg(){return _classCallCheck(this,RepeatingBg),_possibleConstructorReturn(this,_getPrototypeOf(RepeatingBg).call(this))}return _inherits(RepeatingBg,Laya.Script),_createClass(RepeatingBg,[{key:"onAwake",value:function(){e=this.owner.width}},{key:"onUpdate",value:function(){this.owner.x<=-e&&(this.owner.x+=2*e)}}]),RepeatingBg}(),i=function(e){function BirdCtrl(){return _classCallCheck(this,BirdCtrl),_possibleConstructorReturn(this,_getPrototypeOf(BirdCtrl).call(this))}return _inherits(BirdCtrl,Laya.Script),_createClass(BirdCtrl,[{key:"onAwake",value:function(){Laya.stage.on(Laya.Event.MOUSE_DOWN,this,this.mouseDown),this.owner.getComponent(Laya.RigidBody).type="static",Laya.stage.on("GameAgain",this,this.gameAgain),Laya.stage.on("GameStart",this,this.gameStart)}},{key:"gameStart",value:function(){this.owner.getComponent(Laya.RigidBody).type="dynamic",this.mouseDown()}},{key:"gameAgain",value:function(){Laya.stage.isGameOver=!1,this.owner.autoAnimation="idle",this.owner.pos(300,402),this.owner.rotation=0,this.mouseDown()}},{key:"mouseDown",value:function(){!Laya.stage.isGameOver&&Laya.stage.isStart&&(this.owner.getComponent(Laya.RigidBody).linearVelocity={x:0,y:-10},this.owner.autoAnimation="fly",this.owner.loop=!1,Laya.SoundManager.playSound("audio/fly.mp3"))}},{key:"onUpdate",value:function(){this.owner.isPlaying||(this.owner.autoAnimation="idle")}},{key:"onTriggerEnter",value:function(e){"topBox"===e.owner.name||Laya.stage.isGameOver||(this.owner.autoAnimation="die",Laya.SoundManager.playSound("audio/hit.mp3"),Laya.stage.isGameOver=!0,Laya.stage.event("GameOver"))}}]),BirdCtrl}(),o=0,s=0,r=function(e){function ColumnSpawn(){var e;return _classCallCheck(this,ColumnSpawn),(e=_possibleConstructorReturn(this,_getPrototypeOf(ColumnSpawn).call(this))).columnPre=null,e}return _inherits(ColumnSpawn,Laya.Script),_createClass(ColumnSpawn,[{key:"onAwake",value:function(){t=this.owner.getChildByName("columnParent"),Laya.stage.on("GameAgain",this,this.gameAgain)}},{key:"gameAgain",value:function(){o=0,s=0,t._children.concat().forEach(function(e,t){e.removeSelf()})}},{key:"onUpdate",value:function(){!Laya.stage.isGameOver&&Laya.stage.isStart&&(o+=Laya.timer.delta)>s&&(o=0,s=this.getRandom(2e3,3500),this.spawn())}},{key:"spawn",value:function(){if(!Laya.stage.isGameOver){var e=Laya.Pool.getItemByCreateFun("Column",this.createFun,this),a=Laya.Pool.getItemByCreateFun("Column",this.createFun,this);e.isPassed=!1,e.rotation=0;var n=this.getRandom(300,660);e.pos(1920,n);var i=n-this.getRandom(245,345);a.rotation=180,a.pos(2176,i>20?i:20),a.isPassed=!0,t.addChild(e),t.addChild(a)}}},{key:"createFun",value:function(){return this.columnPre.create()}},{key:"getRandom",value:function(e,t){return Math.random()*(t-e)+e}}]),ColumnSpawn}(),l=function(e){function UICtrl(){var e;return _classCallCheck(this,UICtrl),(e=_possibleConstructorReturn(this,_getPrototypeOf(UICtrl).call(this))).blackBg=null,e.scoreText=null,e._score=0,e}return _inherits(UICtrl,Laya.Script),_createClass(UICtrl,[{key:"onAwake",value:function(){this.scoreText=this.owner.getChildByName("score"),this.blackBg.visible=!1,Laya.stage.on("AddScore",this,function(){this.score++}),Laya.stage.on("GameOver",this,this.gameOver),this.init()}},{key:"init",value:function(){this.rankPannelInit();var e=this.btnAgain=this.blackBg.getChildByName("btn_again");Laya.stage.isStart=!1,this.scoreText.alpha=0,e.on(Laya.Event.CLICK,this,this.btnAgainClick),this.owner.getChildByName("btn_start").on(Laya.Event.CLICK,this,this.startClick)}},{key:"rankPannelInit",value:function(){var e=this.showRank=this.blackBg.getChildByName("btn_rank"),t=this.rankPannel=this.owner.getChildByName("rankPannel");this.endScore=this.blackBg.getChildByName("endScore"),this.rankText=t.getChildByName("rankText"),t.visible=!1,e.on(Laya.Event.CLICK,this,this.rankCLick)}},{key:"rankCLick",value:function(){this.rankPannel.visible=!0,this.rankPannel.show(!0,!0);var e=Laya.LocalStorage.getItem("rankInfo");(e=e?JSON.parse(e):[0,0,0]).push(this.score),e.forEach(function(t,a){e[a]=parseInt(t)}),e.sort(function(e,t){return t-e}),e.length>100&&(e.length=100),Laya.LocalStorage.setItem("rankInfo",JSON.stringify(e)),this.rankText.text="1 - ".concat(e[0],"\n2 - ").concat(e[1],"\n3 - ").concat(e[2])}},{key:"startClick",value:function(e){e.currentTarget.visible=!1,Laya.stage.isStart=!0,Laya.stage.event("GameStart"),this.owner.getChildByName("title").visible=!1,this.scoreText.alpha=1}},{key:"btnAgainClick",value:function(e){if(1===this.blackBg.alpha){e.currentTarget;Laya.stage.event("GameAgain"),this.score=0,this.scoreText.visible=!0,this.blackBg.visible=!1}}},{key:"gameOver",value:function(){this.scoreText.visible=!1,this.blackBg.visible=!0,this.blackBg.alpha=0,this.endScore.text="本局得分:"+this.score,Laya.Tween.to(this.blackBg,{alpha:1},500,Laya.Ease.linearIn,new Laya.Handler(this,function(){}),100,!1,!0)}},{key:"score",get:function(){return this._score},set:function(e){e=parseInt(e),this._score=e,this.scoreText.text="score: "+e}}]),UICtrl}(),c=function(e){function PassColumn(){return _classCallCheck(this,PassColumn),_possibleConstructorReturn(this,_getPrototypeOf(PassColumn).call(this))}return _inherits(PassColumn,Laya.Script),_createClass(PassColumn,[{key:"onUpdate",value:function(){this.owner.x<-255&&(this.owner.removeSelf(),Laya.Pool.recover("Column",this.owner)),this.owner.x<=206&&!this.owner.isPassed&&(this.owner.isPassed=!0,Laya.SoundManager.playSound("audio/gold.mp3"),Laya.stage.event("AddScore"))}}]),PassColumn}(),u=function(){function GameConfig(){_classCallCheck(this,GameConfig)}return _createClass(GameConfig,null,[{key:"init",value:function(){var e=Laya.ClassUtils.regClass;e("scripts/AutoMove.js",a),e("scripts/RepeatingBg.js",n),e("scripts/BirdCtrl.js",i),e("scripts/ColumnSpawn.js",r),e("scripts/UICtrl.js",l),e("scripts/PassColumn.js",c)}}]),GameConfig}();u.width=1920,u.height=1080,u.scaleMode="showall",u.screenMode="horizontal",u.alignV="middle",u.alignH="center",u.startScene="Main.scene",u.sceneRoot="",u.debug=!1,u.stat=!1,u.physicsDebug=!1,u.exportSceneToJson=!0,u.init(),new(function(){function Main(){_classCallCheck(this,Main),window.Laya3D?Laya3D.init(u.width,u.height):Laya.init(u.width,u.height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=u.scaleMode,Laya.stage.screenMode=u.screenMode,Laya.stage.alignV=u.alignV,Laya.stage.alignH=u.alignH,Laya.URL.exportSceneToJson=u.exportSceneToJson,(u.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),u.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),u.stat&&Laya.Stat.show(),Laya.alertGlobalError(!0),Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION)}return _createClass(Main,[{key:"onVersionLoaded",value:function(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded))}},{key:"onConfigLoaded",value:function(){u.startScene&&Laya.Scene.open(u.startScene)}}]),Main}())}();